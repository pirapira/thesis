\chapter{Prelinearity Axiom as an Asynchronous Communication Scheme}

	% packages
% \usepackage{setspace}
% \doublespacing

% \usepackage{bussproofs}
% \usepackage{graphicx}
% \usepackage{amssymb}

% % title, author, etc
% \title{Some Disjunctive Tautologies as\\
%  Asynchronous Communication Schemes}
% \author{Yoichi Hirai}

% \usepackage{amsmath}	% required for `\align*' (yatex added)
% \begin{document}

% \maketitle


\subsection{Summary}
%%% abstract
\citet{danos-krivine} investigate
the computational semantics of disjunctive tautologies
such as the excluded middle and the symmetric excluded middle.
They state that those tautologies are synchronization schemes.
Indeed in their formalism, reduction of one term can wait
for another, making synchronization.
However,
one can find no communication among different
concurrent elements in an executable.
In the current paper, we show that logical axioms can specify how
concurrent processes exchange information asynchronously.

We observe the computational behavior of prelinearity axiom
$(\phi\limp\psi)\oplus(\psi\limp\phi)$ and left weakening
on top of IMALL2, which is the fragment of second order
intuitionistic linear logic with connectives $\{\forall, \limp,
\oplus\}$.
We interpret the disjunction~$\oplus$ in the prelinearity axiom
nondeterministically: whether
one process can give information to the other or
vice versa.
In Section~\ref{sec:sync}, where processes wait for others,
we externally specify such nondeterministic choice.
In Section~\ref{sec:async}, where processes do not wait for others,
the nondeterminism appears automatically as a slower process cannot pass
information to a faster one.
We adapt \citet{danos-krivine}'s realizability argument to our
synchronous case and give simulation from the
asynchronous case to the synchronous case.

Our computational semantics here is closely related to
the hyper-lambda calculus for G\"odel--Dummett logic presented in
Chapter~\ref{ch:lambda}.
G\"odel--Dummett logic is axiomatized by Dummett axiom $(\phi\imp\psi)\lor(\psi\imp\phi)$
on top of intuitionistic logic.  \fix{encode and make a better claim}

Our aim in this chapter is reasoning about asynchronous communication on
shared memory using parametricity argument.
However, since processes can write into and read from shared memory,
a straightforward approach would lead us to solving mixed-variant domain
equations or using step-index technique.
Although dealing with general references and parametricity
is manageable~\citep{birkedal2009relational},
we choose a simpler, indirect approach.
First we deal with an operational semantics where communication is made
synchronously and after that we deal with the original operational
semantics involving asynchronnous communication using stores.
Finally, we develop a simulation from the synchronous semantics to the
asynchronous one, ensuring a reduction sequence in the synchronous
semantics has a counterpart in the asynchronous semantics.
% \fix{is schedule needed? maybe not.}
% with schedule, the operational semantics becomes deterministic

%%% 2. terms types and _models_?
\section{Synchronous Semantics}
\label{sec:sync}

\subsection{Dynamics}
We consider a programming language, which is a modification of
Danos and Krivine's.
We assume a set~$\pvar$ of propositional variables whose cardinality is
countably infinite.
We also assume countably infinitely many channels.
Metavariables $c$ and $d$ run over channels.
An s-term\index{term!s-term} (synchronous term)~$t$ is defined by BNF:
\[
 t::= x
 \mid (t)t
 \mid \lambda x.t
 \mid \ast_t
 \mid \mat t x t x t
 \mid \inl t
 \mid \inr t
 \mid (t\conc t)
 \mid \comod c c
\]
where $x$ is a variable and $c$ is a channel.
An s-stack\index{stack!s-stack} (synchronous stack)~$\pi$ is defined by BNF:
\[
 \pi ::= \epsilon
 \mid t\cdot \pi
 \mid \mats x t \pi x t \pi
 \enspace.
\]
We write the set of s-terms as $\sLambda$ and s-stacks~$\sPi$.
An s-executable\index{executable!s-executable} (synchronous executable)) is a multiset on $\sLambda\times\sPi$.
We use $\conc$ for delimiting elements in an s-executable.
We denote the empty multiset by~$\emptyset$.

% 2a' reduction
A schedule\index{schedule} is a total order on channels.
Given a fixed schedule~$\sche$, the reduction\index{reduction} relation~$\sred$
on s-executables
is defined to be the smallest preorder
that satisfies:
\begin{description}
 \item[(cong)] if
      $e_0         \sred e_1$
      then
      $[e_0 \conc e] \sred [e_1\conc e]$\enspace;
 \item[(push)]
	    $[(t)u,\pi]      \sred [t,u\cdot\pi]$      \enspace;
 \item[(store)]
	    $[\lambda x.t,u\cdot\pi]
	     \sred
	     [t[\ast_u/x],      \pi]$\enspace;
 \item[(load)]
	    $[\ast_u,\pi]\sred [u,\pi]$\enspace;
 \item[(dist)]
           $[(t\conc u),\pi]  \sred [t,\pi\conc u,\pi]$ \enspace;
 \item[(ask)]
      $[\mat t x u y v,\pi]\sred [t,\mats x u \pi y v \pi]$\enspace;
 \item[(ansL)]
           $[\inl{v}, \mats xt\pi yu\sigma] \sred [t[v/x],\pi] $ \enspace;
 \item[(ansR)]
           $[\inr{w}, \mats xt\pi yu\sigma] \sred [u[w/y],\sigma] $ \enspace;
 \item[(com0)]
           $[\comod c{d}, t\cdot\pi\conc \comod{d}c,
           u\cdot\sigma] \sred
           [u,\pi]$\enspace(if $d\sche c$ but $c\not\sche d$)\enspace;
 \item[(com1)]
	    $[\comod c{d}, t\cdot\pi\conc \comod{d}c,
	    u\cdot\sigma] \sred
	    [t,\sigma]$\enspace(if $c\sche d$ but $d\not\sche c$)\enspace; and
 \item[(com2)]
	    $[\comod c{d}, t\cdot\pi\conc \comod{d}c,
	    u\cdot\sigma] \sred
	    [u,\pi\conc t,\sigma]$\enspace(if $c\sche d$ and $d\sche
       c$)\enspace.
\end{description}
Rules (cong), (push), (store), (load) and (dist) come from \citet{danos-krivine}.
Below, we sometimes omit the outermost parentheses (i.e. [ and ]) for multisets.

% I want to write these rules are non-blocking here.
% but, actually, Danos and Krivines rules are also non-blocking.
% they just busy-wait.
% In order to remove busy-waiting, we need types.

% 2b type system -- remove pierce -- add com'

\subsection{Statics}
For a set~$S$,
$\form(S)$ is the set of formulas~$\phi$:
\[
\phi::= s \mid X \mid \phi\limp\phi\mid \phi\oplus\phi\mid
\forall X \phi
\]
where $s\in S$ and $X\in \pvar$.
The connective $\forall$ connects stronger than $\oplus$, which is
stronger than $\limp$.
Recurring $\limp$,
$\phi_0\limp\phi_1\limp\cdots\limp\phi_n$ is defined inductively on~$n$
as
$\phi_0\limp(\phi_1\limp\cdots\limp\phi_n)$.
A type is an element of $\form(\emptyset)$.

A sequent\index{sequent} $\sequent{\G}{\tj t\phi}$ consists of a
context~$\G$ and an s-term~$t$ associated with a type~$\phi$.
The context\index{context} is a finite sequence of variables associated with types.

A derivation\index{derivation} is a tree composed of the derivation
rules in Figure~\ref{fig:pole-typing}
whose top rules are Ax.
An s-term~$t$ has a type~$\phi$ when $\tr\tj{t}{\phi}$ is derivable.

 \begin{figure}
 \centering
\AxiomC{}
\LL  {Ax}
\useq{\xphi}{\xphi}
\DisplayProof
\ruleskip
%
\aseq{\xphi,\G}{\tj t\psi}
\LL{$\limp$I}
\useq{\G}{\tj{\lambda x.t}{\phi\limp\psi}}
\DisplayProof
\hfill
%
\aseq{\G}{\tj t{\phi\limp\psi}}
\aseq{\D}{\tj u\phi}
\LL   {$\limp$E}
\bseq{\G,\D}{\tj{(t)u}\psi}
\DisplayProof
\ruleskip
%
\aseq{\G}{\tj{t}{\phi}}
\LL  {$\oplus$I}
\useq{\G}{\tj{\inl{t}}{\phi\oplus\psi}}
\DisplayProof
\hfill
%
\aseq{\G}{\tj{t}{\psi}}
\LL  {$\oplus$I}
\useq{\G}{\tj{\inr{t}}{\phi\oplus\psi}}
\DisplayProof
\ruleskip
%
\aseq{\G}{\tj{t}{\phi\oplus\psi}}
\aseq{\D,\xphi}{\tj{u_0}{\theta}}
\aseq{\D,\ypsi}{\tj{u_1}{\theta}}
\LL  {$\oplus$E}
\tseq{\G,\D}{\tj{\mat{t}{x}{u_0}{y}{u_1}}{\theta}}
\DisplayProof
\ruleskip
%
\aseq\G{\tj t\phi}
\LL   {$\forall$I}
\useq\G{\tj t{\forall X\phi}}
\DisplayProof ($\G$ does not contain $X$ freely)
\hfill
%
\aseq{\G}{\tj{t}{\forall X\phi}}
\LL   {$\forall$E}
\useq{\G}{\tj{t}{\phi[\psi/X]}}
\DisplayProof
\ruleskip
%
\aseq{\tj{x}{\phi\limp\psi},\G}{\tj t\theta}
\aseq{\tj{y}{\psi\limp\phi},\D}{\tj u\theta}
\LL{Com}
\bseq{\G,\D}{\tj{(t[\comodL/x]\conc u[\comodR/y])}{\theta}}
\DisplayProof
\ruleskip
%
\aseq{\G,\tj{x}{\phi},\tj{y}{\psi},\D}{\tj{t}{\theta}}
\LL{Ex}
\useq{\G,\tj{y}{\psi},\tj{x}{\phi},\D}{\tj{t}{\theta}}
\DisplayProof
  \caption{Typing derivation rules.}
  \label{fig:pole-typing}
 \end{figure}

With these rules, there is an s-term typed with the prelinearity axiom.
 \begin{example}
  \label{ex:prelin-term}
  The s-term $(\inl{\comodL}\conc\inr{\comodR})$ has
  a type $\forall X\forall Y((X\limp Y)\oplus(Y\limp X))$.  The typing
  derivation is in Figure~\ref{fig:prelin-term}.
 \end{example}

 \begin{sidewaysfigure}
 \begin{center}
  \AxiomC{}
  \LL{Ax}
  \useq{\tj{x}{X\limp Y}}{\tj{x}{X\limp Y}}
  \LL{$\oplus$I}
  \useq{\tj{x}{X\limp Y}}{\tj{\inl{x}}{(X\limp Y)\oplus (Y\limp X)}}
  \AxiomC{}
  \LL{Ax}
  \useq{\tj{y}{Y\limp X}}{\tj{y}{Y\limp X}}
  \LL{$\oplus$I}
  \useq{\tj{y}{Y\limp X}}{\tj{\inr{y}}{(X\limp Y)\oplus(Y\limp X)}}
  \LL{Com}
  \bseq{}{\tj{(\inl{\comodL}\conc\inr{\comodR})}{(X\limp Y)\oplus(Y\limp
  X)}}
  \LL{$\forall$I}
  \useq{}{\tj{(\inl{\comodL}\conc\inr{\comodR})}{
  \forall Y((X\limp Y)\oplus(Y\limp X))}}
  \LL{$\forall$I}
  \useq{}{\tj{(\inl{\comodL}\conc\inr{\comodR})}{
  \forall X\forall Y((X\limp Y)\oplus(Y\limp X))}}
  \DisplayProof
 \end{center}
  \caption{A derivation tree typing an s-term with the prelinearity axiom.}
  \label{fig:prelin-term}
 \end{sidewaysfigure}

Note that Com rule introduces a restricted form of weakening on the left
as in Figure~\ref{fig:weakening}.
 \begin{figure}
  \centering
\AxiomC{}
\useq{\phi\limp\phi}{\phi\limp\phi}
\aseq{\G}{\phi}
\bseq{\phi\limp\phi,\G}{\phi}
\AxiomC{}
\useq{\phi\limp\phi}{\phi\limp\phi}
\aseq{\D}{\phi}
\bseq{\phi\limp\phi,\D}{\phi}
\bseq{\G,\D}{\phi}
\DisplayProof
  \caption{Com rule introduces a restricted form of weakening on the
  left.  }
  \label{fig:weakening}
 \end{figure}

\subsection{Specification Using Poles}

% 2C truth values and models. make them disjunctive!
%    so that the empty set does not count as successful.
%    Also, make it closed for ``for all''
\begin{definition}
 \label{def:pole}
A pole\index{pole}~$\bbot$ is a set of s-executables
which satisfies
\begin{enumerate}
 \item \label{red-closed} $e$ is in $\bbot$ if $e\sred e'$ and
       $e'\in\bbot$; and
 \item \label{conc-closed} if $e$ or $f$ is in $\bbot$
       then $e\conc f\in\bbot$.
\end{enumerate}
\end{definition}
In the definition of poles,
condition~\ref{conc-closed}.~is different from that from \citet{danos-krivine}'s
definition.
There, the condition says if $e$ \textit{and} $f$ \textit{are} in
$\bbot$, then $e\conc f$ is in $\bbot$.  Our choice here is influenced
by hypersequents~\citep{avron91} and hyper-lambda
calculi~\citep{hiraiflops2012},
where
components are interpreted disjunctively.
We want at least one element of the multiset
$[t_0,\pi_0\conc \cdots \conc t_n,\pi_n]$ to succeed.

An environment\index{environment} is a pair of an s-stack and an s-executable.
The set of environments is written as~$E$.
A program\index{program} is a pair of an s-term and an s-executable.
For a set~$\mathcal Z$ of environments, $\mathcal Z\rightarrow\bbot$ denotes
the set of programs $(t,e)$ such that
for any environment $(\pi,e')\in \mathcal Z$,
the s-executable $t,\pi\conc e \conc e'$ is in $\bbot$.
A set $\mathcal X$ of programs is called a truth value
iff there exists
such $\mathcal Z$ that $\mathcal X = \mathcal Z\rightarrow \bbot$.
We define programs and environments because if we continue using
s-terms and s-stacks, the proof of adequacy (\thref{c:adequacy}) gets
stuck in the case for
($\limp$E,~\textminus), \ref{c:second}.

For $\phi\in\form(2^E)$ and $|\cdot|^-_0\colon\pvar\rightarrow 2^E$,
we define $\nsem{\phi}\colon
2^E$ inductively on~$\phi$:
\begin{align*}
 \nsem{\mathcal Z} =& \mathcal Z \text{ for } \mathcal Z\in 2^E\\
 \nsem{X}=& |X|_0^- \\
 \nsem{\phi\limp\psi}=&
 \{(t\cdot\pi, e_0\conc e_1)\mid
 (t,e_0)\in\nsem\phi\rightarrow\bbot \text{ and }(\pi,e_1)\in\nsem\psi\}\\
 \nsem{\phi\oplus\psi}=& \{(\mats x{t}{\pi}y{u}{\sigma}, f)\mid\\ &
 t[v/x],\pi\conc f\conc f'\in\bbot \text{ for all } (v,f')\in\nsem{\phi}\rightarrow\bbot\text{
 and }\\ &
 u[w/y],\sigma\conc f\conc f'\in\bbot \text{ for all } (w,f')\in\nsem{\psi}\rightarrow\bbot\}
 \\
 \nsem{\forall X\phi}=&
 \bigcup_{\mathcal Z\in 2^\sPi} \nsem{\phi[\mathcal Z/X]}\enspace.
\end{align*}
Using this, we define $\sem \phi=\nsem{\phi}\rightarrow\bbot$.
We have an equality
$\nsem{\phi\limp\psi} = \{(t\cdot\pi, e_0\conc e_1)\mid
(t,e_0)\in\sem\phi\text{ and }(\pi,e_1)\in\nsem\psi\}$.
Moreover, for types~$\phi$ and $\psi$, we define $\sempair{\phi,\psi}$
as the set of triples $(t,u,e)$ of s-terms $t$ and $u$ and an s-executable~$e$
such
that
$t,\pi\conc u,\sigma\conc e\conc e_0\conc e_1
\in\bbot$ for any $(\pi,e_0)\in\nsem\phi$
and $(\sigma,e_1)\in\nsem\psi$.

\begin{proposition}
 \label{squash}
 If $(t,u,e)$ is in $\sem{\phi,\phi}$ then $((t\conc u), e)$ is in
 $\sem\phi$.
\end{proposition}
\begin{proof}
 For any $\pi\in\nsem\phi$,
 the s-executable $[(t\conc u),\pi\conc e]$ reduces to $[t,\pi\conc
 u,\pi\conc e]$ by (dist).
 The reduct is in $\bbot$ by assumption.
 So, the original s-executable is also in~$\bbot$.
\end{proof}

\begin{proposition}
 \label{comod-type}
 $(\comodL,\comodR,\emptyset)\in\sempair{\phi\limp\psi,\psi\limp\phi}$
 for any types~$\phi$ and $\psi$.
\end{proposition}
\begin{proof}
 Take any $(t\cdot\sigma,e_{0}\conc e_{1})\in\nsem{\phi\limp\psi}$
 and $(u\cdot\pi,f_{0}\conc f_{1})\in\nsem{\psi\limp\phi}$ so that
 $(t, e_{0})\in\sem{\phi}$, $(\sigma,e_{1})\in\nsem{\psi}$,
 $(u, f_{0})\in\sem{\psi}$ and $(\pi,f_{1})\in\nsem{\phi}$ hold.
 We claim that $e=\comodL,t\cdot\sigma\conc\comodR,u\cdot\pi\conc
 e_{0}\conc e_{1}\conc f_{0}\conc f_{1}$ is in
 $\bbot$.
 Depending on the schedule, $e$ might reduce to
 $ t,\pi\conc e_{0}\conc e_{1}\conc f_{0}\conc f_{1}$ and otherwise to
 $ u,\sigma\conc e_{0}\conc e_{1}\conc f_{0}\conc f_{1}$ or
 $ t,\pi\conc u,\sigma\conc e_{0}\conc e_{1}\conc f_{0}\conc f_{1}$,
 all of which are in $\bbot$ because
 $t,\pi\conc e_{0}\conc f_{1}$ and
 $u,\sigma\conc e_{1}\conc f_{0}$ are in $\bbot$.
 Since $\bbot$ is closed for $\sred^{-1}$,
 we have $e\in\bbot$.
\end{proof}

% 2d the adequacy lemma
For $\G = \tj{x_1}{\phi_1},\ldots,\tj{x_n}{\phi_n}$,
we denote by $\sem{\G}$ the set of pairs $(\vec t,e)$ where
$\vec{t} = (t_1,\dots,t_n)$, $e = \bigparallel_{1\le i\le n} e_i$
 and each pair~$(t_i, e_i)$ is in $\sem{\phi_i}$.
For such tuple, $[\vec{t}/\G]$ denotes the simultaneous substitution
$[t_i/x_i]_{i}$.

Here we state adequacy.  What we want is statement~\ref{c:first}.
However, when we try to prove \ref{c:first} by induction on derivations,
the case for Com rule fails.  Thus we deal with two derivations at the
same time.

\begin{theorem}[Adequacy]
 \label{c:adequacy}
 Let these sequents be derivable:
 $  \sequent{\G}{\tj{t}{\phi}} $
 and
 $  \sequent{\D}{\tj{u}{\psi}}$\enspace.
 Under these conditions, we state that:
 \begin{enumerate}[label=(\arabic{*}), ref=\textit{(\arabic{*})}]
  \item \label{c:first} the program
	$
	(t[\vec{g}/\G], e)
	$
	is in $\sem\phi$
	 for any
	$(\vec{g},e)\in\sem{\G}$; and that
  \item \label{c:second}
	when $\G$ and $\D$ are respectively
	equal to $\tj x\theta, \hat\G$ and $\tj y\tau, \hat\D$ up to exchange,
	the following triple is in $\sempair{\phi,\psi}$:
	\[\left(
	t[v/x][\vec g/\hat \G],\quad
	u[w/y][\vec d/\hat \D],\quad
	 e \conc  f \conc e'
	\right)
	\]
	for any
	$(v,w,e')\in\sempair{\theta,\tau}$,
	$(\vec g, e)\in\sem{\hat\G}$ and
	$(\vec d, f)\in\sem{\hat\D}$.
  \end{enumerate}
\end{theorem}
\begin{proof}
 We prove both statements at the same time by induction on the sum of
 the heights of the derivations.  Here we identify sequents up to exchange.
  \begin{description}
  \item[(Ax, Ax)] When both derivations consist of only axiom rules,
       the statements follow from the definitions of $\sem{\phi}$ and
       $\sempair{\phi,\psi}$.
   \item[($\limp$I, \textminus)]
	The derivation for $t$ ends as
	\[
	\aseq{\tj{\hat x}{\phi_0},\G}{\tj{t_1}{\phi_1}}
	\useq{\G}{\tj{\lambda{\hat{x}}.t_1}{\phi_0\limp\phi_1}}
	\DisplayProof\enspace.
	\]
	\begin{enumerate}[label=\textit{(\arabic{*})}]
	 \item Take any
	       $(\vec g, e)\in\sem{\G}$
	       and
	       $(t_0\cdot\pi,e_0\conc e_1)\in\nsem{\phi_0\limp\phi_1}$
	       so that $(t_0,e_0)\in\sem{\phi_0}$ and
	       $(\pi,e_1)\in\nsem{\phi_1}$ hold.
	       We have to show that the following s-executable is in
	       $\bbot$:
	       \[
	       (\lambda\hat x.t_1)[\vec g/\G],
	       t_0\cdot\pi\conc e\conc e_0\conc e_1\enspace.
	       \]
	       The s-executable reduces to
	       \[
		t_1[\ast_{t_0}/\hat x][\vec{g}/\G],\pi\conc{e}\conc e_0\conc{e_1}\enspace.
	       \]
	       We have $(\ast_{t_0}, e_0)\in\sem{\phi_0}$ so, by
	       induction hypothesis~\ref{c:first},
	       the reduct is in $\bbot$.
	       Since $\bbot$ is closed for $\rev\sred$, the original
	       s-executable is in $\bbot$, too.
	 \item Take any $(v,w,e')\in\sempair{\theta,\tau}$,
	       $(\vec g, e)\in\sem{\hat\G}$,
	       $(\vec d, f)\in\sem{\hat\D}$,
	       $(t_0\cdot\pi,e_0'\conc e_1')\in\nsem{\phi_0\limp\phi_1}$ and
	       $(\sigma,f'')\in\nsem\psi$ so that
	       $(t_0,e_0')\in\sem{\phi_0}$ and
	       $(\pi,e_1')\in\nsem{\phi_1}$.
	       We have to show that this s-executable is in $\bbot$:
	       \[
	       (\lambda \hat x. t_1)[v/x][\vec{g}/\G],t_0\pi\conc
	       u[w/y][\vec{d}/\D],\sigma\conc
	       e'\conc {e}\conc {f} \conc{e_0'}\conc{e_1'}\enspace.
	       \]
	       By (store) and (cong), the s-executable reduces to
	       \[
		t_1[v/x][\vec{g}/\G][\ast_{t_0}/\hat x],\pi\conc
	       u[w/y][\vec{d}/\D],\sigma\conc
	       e'\conc {e}\conc {f} \conc{e_0'}\conc{e_1'}\enspace.
	       \]
	       Since $(\ast_{t_0},e_0')$ is in $\sem{\phi_0}$,
	       by induction hypothesis~\ref{c:second}, the reduct is in
	       $\bbot$.  Since $\bbot$ is closed for $\rev\sred$,
	       the original s-executable is also in $\bbot$.
	\end{enumerate}
   \item[($\limp$E, \textminus)]
	The derivation for $t$ ends as
	\[
	\aseq{\G_0}{\tj{t_0}{\phi'\limp\phi}}
	\aseq{\G_1}{\tj{t_1}{\phi'}}
	\bseq{\G_0,\G_1}{\tj{(t_0)t_1}{\phi}}
	\DisplayProof\enspace.
	\]
	\begin{enumerate}[label=\textit{(\arabic{*})}]
	 \item Take any
	       $(\vec{g_0},{e_0})\in\sem{\G_0}$,
	       $(\vec{g_1},{e_1})\in\sem{\G_1}$ and
	       $(\pi,e'')\in\nsem{\phi}$.
	       We have to show that this s-executable is in $\bbot$:
	       \[
		((t_0)t_1)[\vec{g_0}/\G_0][\vec{g_1}/\G_1],\pi\conc
	       {e_0}\conc {e_1}\conc e''.
	       \]
	       By (push), this s-executable reduces to
	       \[
		t_0[\vec{g_0}/\G_0], t_1[\vec{g_1}/\G_1]\cdot \pi
	       \conc {e_0}\conc {e_1}\conc e''.
	       \]
	       By induction hypothesis~\ref{c:first} on both branches,
	       we have $(t_0[\vec{g_0/\G_0}],
	       {e_0})\in\sem{\phi'\limp\phi}$
	       and
	       $(t_1[\vec{g_1}/\G_1],{e_1})\in\sem{\phi'}$.
	       By the latter, we have $(t_1[\vec{g_1}/\G_1]\cdot\pi,
	       {e_1}\conc e'')\in\nsem{\phi'\limp\phi}$.
	       By definition of $\sem{\phi'\limp\phi}$, we have shown that the
	       reduct is in $\bbot$.
	       Since $\bbot$ is closed for $\sred^{-1}$,
	       the original s-executable is also in $\bbot$.
	 \item Variable~$x$ might be contained in $\G_0$ or $\G_1$.
	       \begin{description}
		\item[(case $\G_0 = \tj{x}{\sigma},\hat\G_0$)]
		     Take
		     $(v,w,e')\in\sempair{\sigma,\tau}$,
		     $(\vec{g_0},{e_0})\in\sem{\hat\G_0}$,
		     $(\vec{g_1},{e_1})\in\sem{\G_1}$,
		     $(\vec{d},{f})\in\sem{\hat\D}$,
		     $(\pi,e'')\in\nsem{\phi}$ and
		     $(\sigma,f'')\in\nsem{\psi}$.
		     We have to show that the following s-executable is in
		     $\bbot$:
		     \[
		     ((t_0)t_1)[v/x][\vec{g_0}/\hat\G_0][\vec{g_1}/\G_1],\pi\conc
		     u' ,\sigma\conc \hat e\conc {{e_1}}\conc
		     {e''}\conc{f''}\enspace.
		     \]
		     where
		     $u' = u[w/y][\vec{d}/\hat\D]$ and
		     $\hat e= e'\conc {e_0}\conc {f}$.
		     By (push) and (cong), this s-executable reduces to
		     \[
		     t_0[v/x][\vec{g_0}/\hat\G_0],
		     t_1[\vec{g_1}/\G_1]\cdot\pi
		     \conc
		     u' ,\sigma\conc \hat e\conc {{e_1}}\conc
		     {e''}\conc{f''}\enspace.
		     \]
		     By induction hypothesis~\ref{c:first},
		     $(t_1[\vec{g_1}/\G_1],{e_1})$ is in $\sem{\phi'}$.
		     In addition to this, $(\pi,e'')$ is in $\nsem{\phi}$,
		     making $(t_1[\vec{g_1}/\G_1], {e_1}\conc e'')$ in
		     $\sem{\phi'\limp\phi}$.
		     By induction hypothesis~\ref{c:second},
		     $(t_0[v/x][\vec{g_0}/\hat\G_0], u', \hat e)$ is in
		     $\sempair{\phi'\limp\phi,\psi}$.
		     These make the reduct a member of $\bbot$.
		     Since $\bbot$ is closed for $\rev\sred$, the original
		     s-executable is also in $\bbot$.
		\item[(case $\G_1 = \tj{x}{\sigma},\hat\G_1$)]
		     Take any
		     $(v,w,e')\in\sempair{\sigma,\tau}$,
		     $(\vec{g_0},{e_0})\in\sem{\G_0}$,
		     $(\vec{g_1},{e_1})\in\sem{\hat\G_1}$,
		     $(\vec{d},{f})\in\sem{\hat\D}$,
		     $(\pi,e'')\in\nsem{\phi}$ and
		     $(\sigma,f'')\in\nsem{\psi}$.
		     We have to show that the following s-executable is in $\bbot$:
		     \[
		     ((t_0)t_1)[v/x][\vec{g_0}/\G_0][\vec{g_1}/\hat\G_1],\pi\conc
		     {e_0}
		     \conc\hat{f}\conc
		     e''
		     \]
		     where
		     $\hat f = u[w/y][\vec{d}/\hat\D],\sigma\conc
		     {f}\conc f''\conc {e_1}\conc e'$.
		     By (push) and (cong), this s-executable reduces
		     to
		     \[
		     t_0[\vec{g_0}/\G_0],t_1[v/x][\vec{g_1}/\hat\G_1]\cdot \pi\conc
		     {e_0}
		     \conc\hat{f}\conc
		     e''\enspace.
		     \]
		     By induction hypothesis~\ref{c:second},
		     $(t_1[v/x][\vec{g_1}/\hat\G_1],
		     u[w/y][\vec{d}/\hat\D], {e_1}\conc {f}\conc
		     e')$ is in $\sempair{\phi',\psi}$.
		     So, since $(\sigma,f'')$ is in $\nsem{\psi}$,
		     $(t_1[v/x][\vec{g_1}/\hat\G_1],\hat f)$ is in
		     $\sem{\phi'}$.
		     Moreover we had $(\pi,e'')\in\nsem{\phi}$.
		     Combined,
		     $(t_1[v/x][\vec{g_1}/\hat\G_1]\cdot\pi,\hat f\conc e'')$
		     is in $\nsem{\phi'\limp\phi}$\kern -1pt.
		     By induction hypothesis~\ref{c:first},
		     $(t_0[\vec{g_0}/\G_0],\hat e)$ is in
		     $\sem{\phi'\limp\phi}$.
		     So, the reduct is in $\bbot$, making the original
		     s-executable a member of~$\bbot$.
	       \end{description}
	\end{enumerate}
   \item[($\oplus$I, \textminus)]
       Without loss of generality, we can assume that the
       derivation for $t$ ends as
       \[
       \aseq{\G}{\tj{t'}{\phi_0}}
       \useq{\G}{\tj{\inl{t'}}{\phi_0\oplus\phi_1}}
       \DisplayProof\enspace.
       \]
       \begin{enumerate}[label=\textit{(\arabic{*})}]
        \item Take any $(\vec g, e)\in\sem{\G}$ and
              $(\mats {\hat x}v{\pi_0}{\hat y}w{\pi_1}, e'')$
              in $\nsem{\phi_0\oplus\phi_1}$.
              By induction hypothesis~\ref{c:first},
              $(t'[\vec g/\G], e)$ is in $\sem{\phi_0}$.
              By definition of $\nsem{\phi_0\oplus\phi_1}$,
              the s-executable
              $v[t'[\vec g/\G]/\hat x],\pi_0\conc{e}\conc e''$
              is in
              $\bbot$.
              Since $\bbot$ is closed for $\rev\sred$,
              the s-executable
              $\inl{t'}[\vec g/\G], \mats {\hat x}v{\pi_0}{\hat
              y}w{\pi_1}
              \conc{e}\conc e''$
              is also in $\bbot$.
              This shows the statement because we chose an arbitrary
              element of $\nsem{\phi_0\oplus\phi_1}$.
        \item Take any $(v,w,e')\in\sempair{\theta,\tau}$,
              $(\vec g, e)\in\sem{\hat\G}$,
              $(\vec d, f)\in\sem{\hat\D}$,
              $(\mats{\hat x}{\hat v}{\pi_0}{\hat y}w{\pi_1}, e'')\in
              \nsem{\phi_0\oplus\phi_1}$ and
              $(\sigma,f'')\in\nsem{\psi}$.
              We have to show that the following s-executable is in
              $\bbot$:
              \[
               (\inl t)[v/x][\vec g/\hat\G], \mats{\hat x}{\hat v}{\pi_0}{\hat
              y}w{\pi_1}\conc
              u',\sigma\conc
              \hat e\conc e''\conc f''
              \]
              where
              $u' = u[w/y][\vec d/\hat\D]$ and $\hat e=e'\conc  e\conc
              f$.
              By (ansL), the s-executable reduces to
              $\hat v[t'[v/x][\vec g/\hat\G]/\hat x],\pi_0 \conc
              u',\sigma\conc
              \hat e\conc e''\conc f''
              $.
              By induction hypothesis~\ref{c:second},
              $(t'[v/x][\vec g/\hat \G], u', \hat e)$ is in
              $\sempair{\phi_0,\psi}$.
              So, $(t'[v/x][\vec g/\hat\G], [u',\sigma\conc \hat e\conc
              f''])$ is in $\sem{\phi_0}$.
              By definition of $\nsem{\phi_0\oplus\phi_1}$,
              the reduct is in $\bbot$.
              Since $\bbot$ is closed for $\rev\sred$,
              the original s-executable is also in $\bbot$.
       \end{enumerate}
   \item[($\oplus$E, \textminus)]
       The derivation for $t$ ends in
       \[
       \aseq{\G_0}{\tj{t}{\phi_0\oplus\phi_1}}
       \aseq{\G_1,\tj{\hat{x}}{\phi_0}}{\tj{t_0}{\phi}}
       \aseq{\G_1,\tj{\hat{y}}{\phi_1}}{\tj{t_1}{\phi}}
       \tseq{\G_0,\G_1}{\tj{\mat{t}{\hat x}{t_0}{\hat y}{t_1}}{\phi}}
       \DisplayProof\enspace.
       \]
       \begin{enumerate}[label=\textit{(\arabic{*})}]
        \item Take any $(\vec{g_0},{e_0})\in\sem{\G_0}$,\quad
              $(\vec{g_1},{e_1})\in\sem{\G_1}$
              and
              $(\pi,e')\in\nsem{\phi}$.
              We have to show that the s-executable
              \[
              (\mat t{\hat{x}}{t_0}{\hat{y}}{t_1})[\vec{ g_0}/\G_0][\vec{g_1}/\G_1],
              \pi\conc {e_0}\conc e'\conc {e_1}
              \]
              is in $\bbot$.
              By (ask), the s-executable reduces to
              \[
               t[\vec{g_0}/\G_0],
              \mats{\hat{x}}{t_0[\vec{g_1}/\G_1]}{\pi}
              {\hat{y}}{t_1[\vec{g_1}/\G_1]}{\pi}\conc{e_0}\conc
              {e_1}\enspace.
              \]
              We claim that
              $(\mats{\hat{x}}{t_0[\vec{g_0/\G_0}]}{\pi}{\hat{y}}{t_1}{\pi},{e_1}\conc
              e')$ is in $\nsem{\phi\oplus\psi}$ and that
              $(t[\vec{g_0}/\G_0],{e_0})$ is in $\sem{\phi\oplus\psi}$.  The first
              claim is shown by induction hypothesis~\ref{c:first}
              stating that $(t_0[v/\hat{x}][\vec{g_1}/\G_1], {e_1}\conc
              e'')$ is in $\sem{\phi}$ for any $(v,e'')\in\sem{\phi_0}$
              and similarly to~$t_1$.
              The second claim follows from induction
              hypothesis~\ref{c:first} on $t$.
              By the two claims and by the definition of
              $\sem{\phi\oplus\psi}$,
              we have shown that the reduct is in $\bbot$ and
              thence that the original s-executable is in $\bbot$.
        \item Variable $x$ might be in $\G_0$ or $\G_1$.
              \begin{description}
               \item[(case $\G_0 = \tj x\theta,\hat\G_0$)]
                    Take any
                    $(v,w,e')\in\sempair{\theta,\tau}$,
                    $(\vec{g_0},{e_0})\in\sem{\hat\G_0}$,
                    $(\vec{g_1},{e_1})\in\sem{\G_1}$,
                    $(\vec d, f)\in\sem{\hat\D}$,
                    $(\pi,e')\in\nsem{\phi}$ and
                    $(\sigma,f')\in\nsem\psi$.
                    We have to show that the following s-executable is in
                    $\bbot$:
                    \begin{eqnarray*}
                    (\mat{t'}{\hat x}{t_0}{\hat
                    y}{t_1})[v/x][\vec{g_0}/\hat\G_0][\vec{g_1}/\G_1],\pi\conc\\
                    u[w/y][\vec d/\hat\D],\sigma\conc e'\conc
                    {e_0}\conc {e_1}\conc  f\conc e'\conc
                    f'.
                    \end{eqnarray*}
                    By (ask) and (cong), this s-executable reduces to
                    \begin{eqnarray*}
                    (t'[v/x][\vec{g_0}/\hat\G_0],
                     \mats{\hat x}{t_0[\vec{g_1}/\G_1]}{\pi}{\hat y}{t_1[\vec{g_1}/\G_1]}{\pi}
                     \conc\\
                    u[w/y][\vec d/\hat\D],\sigma\conc e'\conc
                    {e_0}\conc {e_1}\conc  f\conc e'\conc
                    f'\enspace.
                    \end{eqnarray*}
                    By induction hypothesis~\ref{c:second},
                    we have
                    \[
                    (t'[v/x][\vec{g_0}/\hat\G_0], u[w/y][\vec d/\hat\D],
                    e'\conc {e_0}\conc f) \in\sempair{\phi_0\oplus\phi_1,\psi}\enspace.
                    \]
                    Also, we defined $(\sigma,f')$ to be an element of
                    $\nsem\psi$.
                    By definition of $\sempair{\phi_0\oplus\phi_1,\psi}$,
                    the reduct is in $\bbot$.  Since $\bbot$ is closed for
                    $\rev\sred$,
                    the original s-executable is also in $\bbot$.
               \item[(case $\G_1=\tj{x}{\theta},\hat\G_1$)]
                    Take any
                    $(v,w,e')\in\sempair{\theta,\tau}$,
                    $(\vec{g_0},{e_0})\in\sem{\G_0}$,
                    $(\vec{g_1},{e_1})\in\sem{\hat\G_1}$,
                    $(\vec{d},{f})\in\sem{\hat\D}$,
                    $(\pi,e')\in\nsem{\phi}$ and
                    $(\sigma,f')\in\nsem{\psi}$.
                    We have to show that the following s-executable is in
                    $\bbot$:
                    \begin{eqnarray*}
                     (\mat{t'}{\hat x}{t_0}{\hat
                      y}{t_1})[\vec{g_0}/\G_0][v/x][\vec{g_1}/\G_1],\pi\conc \\
                     u[w/y][\vec d/\hat\D],\sigma\conc e'\conc
                      {e_0}\conc {e_1}\conc f\conc e'\conc f'\enspace.
                    \end{eqnarray*}
                    By (ask) and (cong), this s-executable reduces to
                    \begin{align*}
                     e_{\mathrm r} =&
                      t'[\vec{g_0}/\G_0],
                      \mats{\hat x}
                      {(t_0[x/v][\vec{g_1}/\G_1])}{\pi}{\hat y}
                      {t_1[x/v][\vec{g_1}/\G_1]}{\pi}\conc \\
                     &u[w/y][\vec d/\hat\D],\sigma\conc e'\conc
                      {e_0}\conc {e_1}\conc  f\conc e'\conc f'\enspace.
                    \end{align*}
                    By induction hypothesis~\ref{c:second}, for any
                    $(v_0',e_0')\in\sem{\phi_0}$,
                    the triple
                    $(t_0[x/v][\vec{g_1}/\G_1][v_0'/\hat x],
                    u[w/y][\vec d/\hat \D], e'\conc {e_1}\conc
                    e_0'\conc  f)$ is in $\sempair{\phi,\psi}$ so
                    that
                    $(t_0[x/v][\vec{g_1}/\hat\G_1][v_0'/\hat x],
                    [u[w/y][\vec d/\hat D],\sigma\conc e'\conc
                    {e_1}\conc e_0'\conc {f}\conc f''])$ is in
                    $\sem\phi$.
                    We have a symmetric fact for $t_1$.
                    Thus,
                    \begin{align*}
                    (
                     & \mats{\hat x}
                      {(t_0[x/v][\vec{g_1}/\G_1])}{\pi}{\hat y}
                      {t_1[x/v][\vec{g_1}/\G_1]}{\pi}, \\ &
                     [u[w/y][\vec{d}/\hat\D]\conc e'\conc {e_1}\conc
                      f\conc f'']
                    )
                    \end{align*}
                    is in $\nsem{\phi_0\oplus\phi_1}$.
                    By induction hypothesis~\ref{c:first},
                    $(t[\vec{g_0}/\G_0],{e_0})$ is in
                    $\sem{\phi_0\oplus\phi_1}$.
                    By definition of $\sem{\phi_0\oplus\phi_1}$,
                    the reduct $e_{\mathrm r}$ is in $\bbot$.
                    Since $\bbot$ is closed for $\rev\sred$,
                    the original s-executable is also in $\bbot$.
              \end{description}
       \end{enumerate}
   \item[(Com, \textminus)]
	The derivation for $t$ ends in
	\[
	\aseq{\tj{\hat x}{\phi_0\limp\phi_1},\G_0}{\tj{t_0}{\phi}}
	\aseq{\tj{\hat y}{\phi_1\limp\phi_0},\G_1}{\tj{t_1}{\phi}}
	\bseq{\G_0,\G_1}{\tj{(t_0[\comodL/\hat x]\conc t_1
	[\comodR/\hat y])}{\phi}}
	\DisplayProof\enspace.
	\]
	\begin{enumerate}[label=\textit{(\arabic{*})}]
	\item Take any $(\vec{g_0},{e_0})\in\sem{\G_0}$,
	      $(\vec{g_1},{e_1})\in\sem{\G_1}$ and
	      $(\pi,e')\in\nsem{\phi}$.
	      By \thref{comod-type}, we have
	      $(\comodL,\comodR,\emptyset)\in\sempair{\phi_0\limp\phi_1,\phi_1\limp\phi_0}$.
	      By induction hypothesis~\ref{c:second}, the s-terms
	      $t'_0=t_0[\comodL/\hat{x}][\vec{g_0}/\G_0]$ and
	      $t'_1=t_1[\comodR/\hat{y}][\vec{g_1}/\G_1]$
	      satisfy
	      $(t_0',t_1',{e_0}\conc
	      {e_1})\in\sempair{\phi,\phi}$.
	      By \thref{squash}, we have $(t'_0\conc t'_1,
	      {e_0}\conc {e_1})\in\sem{\phi}$.
	\item
	      Without loss of generality,
	      we can assume $(\tj x\theta)\in\G_0$ so that
	      $\G_0 =\tj x\theta, {\hat\G_0}$ up to exchange.
	      Take any
	      $(v,w,e')\in\sempair{\theta,\tau}$,
	     $(\vec{g_0},{e_0})\in\sem{\hat\G_0}$,
	     $(\vec{g_1},{e_1})\in\sem{\G_1}$,
	     $(\vec d, f)\in\sem{\hat\D}$,
	     $(\pi,e'')\in\nsem{\phi}$ and
	     $(\sigma,f'')\in\nsem{\psi}$.
	     We have to show that this s-executable is in $\bbot$:
	     \begin{align*}
	      & (t_0'\conc
	      t'_1),\pi\conc
	      u',\sigma\conc e'\conc
	      {e_0}\conc {e_1}\conc  f\conc e''\conc f''
	     \end{align*}
	     where $t_0' = t_0[\comodL/\hat
	     x][\vec{g_0}/\hat\G_0][v/x]$,
	     $t'_1 = t_1[\comodR/\hat y][\vec{g_1}/\G_1]$ and $u' = u[w/y][\vec{d}/\hat\D]$.
	     By (dist) and (cong), this s-executable reduces to
	     \[
	      t'_0,\pi\conc t'_1,\pi\conc u',\sigma\conc e'\conc
	     {e_0}\conc {e_1}\conc{f}\conc e''\conc f''\enspace.
	     \]
	     Consider the derivation consisting of an axiom
	     $\sequent{\tj{\hat x}{\phi_0\limp\phi_1}}
	     {\tj{\hat x}{\phi_0\limp\phi_1}}$.
	     This derivation is shorter than the derivation for $u$
	     unless the derivation for $u$ also consists of a single axiom.
	     We can use the induction hypothesis~\ref{c:second} on
	     this derivation and the derivation of $u$, or, if the
	     derivation for $u$ also an axiom, we can do the same
	     argument as in (Ax, Ax) case to prove
	     statement~\ref{c:second}.
	     By this, $(\comodL, t_1',{e_1})$ is in
	     $\sempair{\phi_0\limp\phi_1,\phi}$
	     because of \thref{comod-type}.
	     So, program $p =(\comodL,(t_1',\pi\conc{e_1}))$ is in
	     $\sem{\phi_0\limp\phi_1}$.
	     By induction hypothesis~\ref{c:second} for the derivation
	     for $t_0$, especially using the program~$p$ for
	     substituting~$\hat x$, we can show that
	     $(t_0',u',(t_1',\pi\conc {e_1}\conc {e_0}\conc
	     e'\conc {f}))$ is in $\sempair{\phi,\psi}$.
	     Thus, the reduct is in $\bbot$.
	     Since $\bbot$ is closed for $\rev\sred$, the original
	     s-executable is also in $\bbot$.
	\end{enumerate}
  \item[($\forall$I, \textminus)]
       The derivation for $t$ ends in
       \aseq{\G}{\tj t\phi}
       \useq{\G}{\tj t{\forall X\phi}}
       \DisplayProof.
       \begin{enumerate}[label=\textit{(\arabic{*})}]
	\item Take any $(\vec g,{e})\in\sem{\G}$.
	      Since $\G$ does not contain $X$ freely,
	      $\sem\G$ does not change whatever
	      $\nsem{X}_0$ is.
	      On the other hand, since the induction
	      hypothesis~\ref{c:first}
	      holds for arbitrary $\nsem{X}_0$,
	      the program $t[\vec g/\G]$ is in
	      $\bigcap_{\mathcal Z\in 2^\sPi}\sem{\phi[\mathcal Z/X]}$.
	      Since $(\bigcap_{\mathcal Z\in 2^\sPi}\sem{\phi[\mathcal
	      Z/X]})\cdot (\bigcup_{\mathcal Z\in
	      2^\sPi}\nsem{\phi[\mathcal Z/X]})$ is a subset of $\bbot$,
	      the program is in $\sem{\forall X\phi} = \left(\bigcup_{\mathcal
	      Z\in 2^\sPi}\nsem{\phi[\mathcal Z/X]}\right) \rightarrow
	      \bbot$.
	\item Take any
	      $(v,w,e')\in\sempair{\theta,\tau}$,
	      $(\vec g, e)   \in\sem{\hat\G}$,
	      $(\pi,e'')\in\nsem{\forall X\phi}$ and
	      $(\sigma,f'')\in\nsem{\psi}$.
	      We can replace $X$ in the derivation of $t$ with
	      another propositional variable~$X'$ that does not
	      occur in the derivation of $u$.
	      We are going to use the induction hypothesis on the
	      renamed derivation with the s-terms and s-stacks taken above.
	      Since $\theta$ and $\hat\G$ do not contain
	      $X$ freely, we have
	      $(v,w,e')\in\sem{\theta[X'/X],\tau}$,
	      $(\vec{g},{e})\in\sem{\hat\G[X'/X]}$ and $(\pi,e'')\in
	      \nsem{\forall X'\phi[X'/X]}$.
	      By induction hypothesis~\ref{c:second}
	      on the renamed derivation,
	      the s-terms
	      $t' = t[v/x][\vec g/\G]$ and
	      $u' = u[w/y][\vec d/\D]$ satisfy
	      $(t',u', e\conc  f)\in\sem{\phi[X'/X],\psi'}$ for any $\nsem{X'}_0$.
	      That is, for $\mathcal Z\in 2^E$ that makes
	      $(\pi,e'')\in\nsem{\phi[X'/X][\mathcal Z/X']}$ and
	      $(\sigma,f'')\in\nsem{\psi[\mathcal Z/X']}$,
	      $t'\pi\conc u',\sigma\conc e''\conc f''$ is in $\bbot$,
	      making $t',\pi\conc u',\sigma$ an element of
	      $\bbot$..
       \end{enumerate}
  \item[($\forall$E, \textminus)]
       The derivation for $t$ ends in
       \aseq{\G}{\tj t{\forall X\phi}}
       \useq{\G}{\tj t{\phi[\psi/X]}}
       \DisplayProof.
       Both statements follow immediately from the induction hypotheses
       because $\nsem{\phi[\psi/X]}$ is a subset of $\nsem{\forall
       X\phi}$.
   \item[(Other cases)]
	We can swap $t$ and $u$ to find a symmetric case above.
 \end{description}
 \end{proof}
Note that \ref{c:first} uses \ref{c:second} in the (Com,~\textminus)
case
and \ref{c:second} uses \ref{c:first} in the ($\limp$E,~\textminus).

\begin{proposition}
 \label{prop:exec-on-pole}
 The following set is a pole: the set of s-executables that reduces to
 an s-executable containing an element of a fixed set of s-executables.
\end{proposition}

\begin{proposition}
 \label{spec:prelin}
 Let $\tr\tj{g}{\forall X\forall Y((X\limp Y)\oplus (Y\limp X))}$ be
 derivable.
 Then, $\left(g, \mats{z}{z}{x\cdot\pi_Y}{w}{w}{y\cdot\pi_X}\right)$
 reduces to a multiset containing an element of
 $\{(x,\pi_X), (y,\pi_Y)\}$.
\end{proposition}
\begin{proof}
 We denote by $\bbot$ the set of s-executables that reduce to a multiset
 containing an element of $\{(x,\pi_X), (y,\pi_Y)\}$.
 By \thref{prop:exec-on-pole}, this is a pole.
 Take $\nsem{X}_0 = \{(\pi_X,\emptyset)\}$ and
      $\nsem{Y}_0 = \{(\pi_Y,\emptyset)\}$.
 We have $x\in\sem{X}$ and $y\in\sem{Y}$.
 By definition of $\nsem{\cdot}$,
 $\mats{z}{z}{x\cdot\pi_Y}{w}{w}{y\cdot\pi_X}$ is in $\nsem{(X\limp
 Y)\oplus (Y\limp X)}$.
 By adequacy (\thref{c:adequacy}), $\left(g,
 \mats{z}{z}{x\cdot\pi_Y}{w}{w}{y\cdot\pi_X}\right)$ is in $\bbot$.
\end{proof}

\begin{example}
 \label{spec-ex}
 Since $g = (\inl{\comodL}\conc\inr{\comodR})$ has the type
 $\forall X\forall Y((X\limp Y)\oplus (Y\limp X))$ (\thref{ex:prelin-term}),
 this s-term satisfies the condition of \thref{spec:prelin}.
 By (dist),
 $\left(g, \mats{z}{z}{x\cdot\pi_Y}{w}{w}{y\cdot\pi_X}\right)$
 reduces to
 \begin{align*}
  \bigl[& \left(\inl{\comodL},
  \mats{z}{z}{x\cdot\pi_Y}{w}{w}{y\cdot\pi_X}\right) \\ \conc
  & \left(\inr{\comodR}, \mats{z}{z}{x\cdot\pi_Y}{w}{w}{y\cdot\pi_X}\right)\bigr]\enspace.
 \end{align*}
 By (ansL), (ansR) and (cong), the s-term above reduces to
 $[\comodL, x\cdot\pi_Y\conc \comodR,y\cdot\pi_X]$.
 Depending on the schedule,  the s-term above reduces to either
 $[x,\pi_X]$ or $[y,\pi_Y]$ or $[x,\pi_X\conc y,\pi_Y]$.
 Indeed, $g$ reduces to a multiset containing an element of
 $\{(x,\pi_X), (y,\pi_Y)\}$ as stated by \thref{spec:prelin}.
\end{example}

After looking at \thref{spec-ex},
one may wonder whether the statement of \thref{spec:prelin} can be
strenghthened to force $g$ to reduce to a nonempty multiset on
$\{(x,\pi_X), (y,\pi_Y)\}$ without any garbage elements.
However, when there are more than two processes, some garbages can be
produced.
\fix{complete this paragraph or abandon it; but it is an important one}

\begin{proposition}
 \label{prop:spec}
 Let
 $\sequent{}{}{\tj g
 {\forall X\forall A\forall B
 [((A\limp B)\limp X)
  \limp((B\limp A)\limp X)
  \limp X]}}$
 be
 derivable.
 For all s-terms $\rho,\sigma, a,b$ and for all s-stacks $\pi, \pi_A$ and
 $\pi_B$,
 if $[(\rho)d  ,\pi]\sred [d,a\cdot \pi_B]$ and
    $[(\sigma)f,\pi]\sred [f,b\cdot \pi_A]$ hold for all $d$ and $f$,
 then
 $[(g)(\rho)\sigma,\pi]$ reduces to a multiset containing an
 element of
 $\{(a,\pi_A),(b,\pi_B)\}$.
\end{proposition}
\begin{proof}
 We denote by $\bbot$ the set of s-executables that reduce to a multiset
 containing an element of $\{(a,\pi_A), (b,\pi_B)\}$.
 By \thref{prop:exec-on-pole},
 this is a pole.
 Take $\nsem{A}_0 =\{(\pi_A,\emptyset)\}$, $\nsem{B}_0 =
 \{(\pi_B,\emptyset)\}$ and $\nsem{X}_0=\{(\pi,\emptyset)\}$.
 We have $a\in\sem{A}$ and $b\in\sem{B}$.
 We claim $(\rho,\emptyset)\in\sem{(A\limp B)\limp X}$.
 Take any $(d,e)\in\sem{A\limp B}$.
 By assumption and (cong),
 $[(\rho)d,\pi\conc e]$ reduces to $[d,a\cdot\pi_B\conc e]$,
 where the reduct is in $\bbot$ because $(d,e)$ is in $\sem{A\limp B}$.
 Since $\bbot$ is closed for $\rev\sred$,
 $[(\rho)d,\pi\conc e]$ is also in $\bbot$, making
 $(\rho,\emptyset)$ a member of $\sem{(A\limp B)\limp X}$.
 Likewise,
 $(\sigma,\emptyset)$ is a member of $\sem{(B\limp A)\limp X}$.
\end{proof}

% not really useful
% \begin{proposition}
%  The set of executables which do not reduce to $\emptyset$ forms a pole.
% \end{proposition}
% \begin{proof}
%  This is a special case of \thref{prop:exec-on-pole}
% \end{proof}

Another important property of an s-executable is
non-abortfullness
which states that the s-executable has no reduction sequence leading to
$\emptyset,S$.
The name comes from hyper-lambda calculus formulation in~\citep{hiraiflops2012},
where a s-term sometimes turns into $\mathsf{abort}$ and there the property
stated that a hyper-term has no reduction sequence leading to a hyper-term
full of $\mathsf{abort}'s$.
This property is necessary for s-terms to denote
constructive content of proofs.

\begin{proposition}[Non-abortfullness]
 Let $t$ be a s-term and $\pi$ an s-stack, then,
 $[t,\pi]$ does not reduce to $\emptyset$.
\end{proposition}
\begin{proof}
 By definition of $\sred$.
\end{proof}

\section{Asynchronous Semantics}
\label{sec:async}

An a-term\index{term!a-term} (asynchronous term)~$t$ is defined by BNF:
\[
 t::= x
 \mid (t)t
 \mid \lambda x.t
 \mid \ast_t
 \mid \mat t x t x t
 \mid \inl t
 \mid \inr t
 \mid (t\conc t)
 \mid \comod c c
 \mid \reader  c
\]
where $x$ is a variable and $c$ is a channel.
Compared with the synchronous case, now we have one additional kind of term
$\reader c$.
An a-stack\index{stack!a-stack} (asynchronous stack)~$\pi$ is defined by BNF:
\[
 \pi ::= \epsilon
 \mid t\cdot \pi
 \mid \mats x t \pi x t \pi
 \enspace.
\]
The definition of a-stacks are not changed from the synchrnous case except
that the a-terms in the definition can be $\reader c$.
Overall, all s-terms and s-stacks are also a-terms and a-stacks.
We write the set of a-terms as $\aLambda$ and a-stacks~$\aPi$.
A store\index{store} is a partial mapping from locations to
a-terms, equivalently, a mapping from locations to a-terms and $\bot$'s.
The empty store\index{store!empty}%
\index{empty store|see{store}}~$S_\epsilon$ maps any channel to $\bot$.
For a store $S$, we define a store $S[c\colon\phi\mapsto x]$ to be
the same as $S$ except that $S[c\colon\phi\mapsto x](c\colon\phi\mapsto
x)$ is $x$.
An a-executable\index{executable!a-executable} (asynchronous executable)
is a finite multiset on $\aLambda \times \aPi$,
paired with a store.

% 2a' reduction
We have reduction relation~$\ared$ on a-executables,
which is defined to be the smallest binary preorder
that satisfies:
\begin{description}
 \item[(cong)] if
	    $[t,\pi],         S \ared [ t',\pi'],        S'$
	    then
	    $[t,\pi \conc e], S \ared [ t',\pi'\conc e], S'$\enspace;
 \item[(push)]
	    $[(t)u,\pi],S       \ared [t,u\cdot\pi],S$;
 \item[(dist)]
	    $[t\conc u,\pi],S   \ared [t,\pi\conc u,\pi],S$\enspace;
 \item[(store)]
	    $[\lambda x.t,u\cdot\pi],S
	     \ared
	     [t[\ast_u/x],      \pi],S$\enspace;
 \item[(load)]
	    $[\ast_u,\pi],S\ared[u,\pi],S$\enspace;
 \item[(ask)]
      $[\mat t x u y v,\pi], S\ared [t,\mats x u \pi y v \pi], S$\enspace;
 \item[(ansL)]
      $[\inl{v}, \mats xt\pi yu\sigma],S \ared [t[v/x],\pi],S $ \enspace;
 \item[(ansR)]
      $[\inr{w}, \mats xt\pi yu\sigma],S \ared [u[w/y],\sigma],S $ \enspace;
 \item[(write)]
	    $
	    [\comod c{d}, t\cdot\pi], S[d\colon\psi\mapsto\bot]
	    \ared
	    [\reader c, \pi],
	    S[d\colon\psi\mapsto t]
	    $\enspace;
 \item[(write')]
	    $
	    [\comod c{d}, t\cdot\pi], S[d\colon\psi\mapsto u]
	    \ared
	    [\reader c, \pi],
	    S[d\colon\psi\mapsto u]
	    $\enspace;
 \item[(read)]$
	    [\reader c ,\pi],
	    S[c\colon\phi\mapsto u]
	    \ared
	    [u,\pi],
	    S[c\colon\phi\mapsto u]
	    $\enspace; and
 \item[(fail)]
	    $
	    [\reader c,\pi],
	    S[c\colon\phi\mapsto \bot]
	    \ared
	    \emptyset,S[c\colon\phi\mapsto \bot]
	    $
	    \enspace.
\end{description}
Differently from the synchronous case in Section~\ref{sec:sync},
we do not use an external schedule relation on channels.
Instead, nondeterminism appears spontaneously.
We can implement something similar to Lafont's example~\citep[B.1]{girard1989proofs},
showing that confluence does not hold.
Suppose $\G\tr\tj t\phi$ and $\G\tr\tj u\phi$ are both derivable.
Then, by induction on the derivation,
both $\G,\tj x{\phi\limp\phi}\tr\tj{(x)t}\phi$
and $\G,\tj y{\phi\limp\phi}\tr\tj{(y)u}\phi$ are derivable
for $x$ and $y$ not appearing in $\G$, $u$, or $t$.
By the communication rule,
$\G\tr\tj{(\comod c{d})t\conc(\comod {d} c)u}\phi$ is derivable.
However $[((\comod c{d})t\conc (\comod{d} c)u),
\pi],S_\epsilon$
can reduce both to $[t,\pi], S_\epsilon[c\mapsto u, d\mapsto t]$
and to $[u,\pi], S_\epsilon[c\mapsto u,d\mapsto t]$ (Figure~\ref{fig:lafont}).
\begin{figure}
 \begin{subfigure}[b]{0.45\textwidth}
  \begin{align*}
   & [((\comodL)t\conc (\comodR) u),\pi], S_\epsilon \\
   \ared & [(\comodL)t,\pi\conc (\comodR)u,\pi], S_\epsilon \\
   \ared & [\reader c, \pi\conc (\comodR)u,\pi], S_\epsilon[d\mapsto
   t] \\
   \ared & [(\comodR)u,\pi], S_\epsilon[d\mapsto t] \\
   \ared & [\reader d, \pi], S_\epsilon[c\mapsto u, d\mapsto t] \\
   \ared & [t,\pi], S_\epsilon[c\mapsto u,d\mapsto t]\enspace.
  \end{align*}
 \end{subfigure}
 \begin{subfigure}[b]{0.45\textwidth}
  \begin{align*}
   & [((\comodL)t\conc (\comodR) u),\pi], S_\epsilon \\
   \ared & [(\comodL)t,\pi\conc (\comodR)u,\pi], S_\epsilon \\
   \ared & [(\comodL)t,\pi\conc \reader d,\pi], S_\epsilon[c\mapsto u] \\
   \ared & [(\comodL)t,\pi], S_\epsilon[c\mapsto u] \\
   \ared & [\reader c,\pi], S_\epsilon[c\mapsto u,d\mapsto t] \\
   \ared & [u,\pi], S_\epsilon[c\mapsto u,d\mapsto t]\enspace.
  \end{align*}
 \end{subfigure}
 \caption[A non-confluent example similar to Lafont's example.]
 {A non-confluent example similar to Lafont's example.  Both sides start
 from the same configuration but reduces to different configurations.
 Moreover, since terms $t$ and $u$ can be taken arbitrarily, if we
 equate the terms related by $\ared$, we have to conclude that arbitrary
 two terms are equal.}
 \label{fig:lafont}
\end{figure}
Since $t$ and $u$ were taken arbitrarily, we cannot distinguish a-terms
of the same type if we equate an a-term with any a-terms it reduces to.

\begin{definition}
 An s-executable~$e$ is well-formed iff
 \begin{enumerate}
  \item \label{well1} at most one occurrence of $\comodL$ or $\reader c$ appears in
	$e$; and
  \item \label{well2} at most one occurrence of each bound variable appears in $e$.
 \end{enumerate}
\end{definition}

\begin{proposition}
 If an s-term~$t$ is typed, the s-executable $[t,\epsilon]$ is well-formed.
\end{proposition}
\begin{proof}
 Condition~\ref{well1}.~holds because of the form of Com rule.
 Condition~\ref{well2}.~holds
 because there are no contraction rules.
\end{proof}

\begin{proposition}
 Let $e$ be a well-formed s-executable.
 If $e\sred e'$ in the synchronous case on a schedule then $e, S_\epsilon \ared e', S'$
 in the asynchronous case for some store~$S'$.
\end{proposition}
\fix{prove}

\section{Discussion}

\subsection{Unintended Weakening}

Our type system allows a restricted form of weakening as shown in
Figure~\ref{fig:weakening}.  Introducing any form of weakening is not
our intention.  We consider two possible remedies.  The first possible
remedy is modifying the communication rule so that the contexts are
treated in the additive way.\\
\fix{draw}\\
The other possible remedy is employing the hypersequent system.  We use
the hyper-communication rule and external contraction.  When we try to
duplicate Figure~\ref{fig:weakening}, we cannot get weakening as shown
in Figure~\fix{fig:lack-weakening}.
Both of these remedies, however, destroy the inductive proof of
adequacy.  There, since the
interesting variable $x$ can appear in more than one branch,
we need stronger induction hypothesis.

\subsection{Comparison with monoidal t-norm logic}

There is a well-known substructural logic called monoidal t-norm logic
(MTL), which validates the prelinearity axiom
$(\phi\limp\psi)\oplus(\psi\limp\phi)$.  When we extend our system with
unrestricted left weakening, our system characterizes MTL\fix{?}.

The MTL formulas can be defined as%
\footnote{From the standard literature~\citep{handbook:fuzzy}, the connectives
are translated as \fix{fill}}%
:
\[
 \phi::= \bar{0}\mid p\mid \phi\limp\psi \mid \phi\otimes \psi \mid \phi \land \psi\enspace.
\]

We give a translation from MTL formulae to our language as:
\begin{align}
 \bar{0}^\bullet &= \forall XX \nonumber\\
 p^\bullet &= p \nonumber\\
 (\phi\limp\psi)^\bullet &= \phi^\bullet \limp \psi^\bullet\nonumber\\
 (\phi\otimes\psi)^\bullet & = \forall
 X((\phi^\bullet\limp\psi^\bullet\limp X)\limp X) \nonumber\\
 (\phi\land \psi)^\bullet &=
 (\phi^\bullet\otimes(\phi^\bullet\limp\psi^\bullet))\oplus
 (\psi^\bullet \otimes(\psi^\bullet \limp\phi^\bullet)) \label{eq:abb}
\end{align}
where the translation of $\land$ is a tailor-made one for MTL,
 which is taken from \citep[p.~48]{handbook:fuzzy}.  The translation
can be traced back to \fix{fill after looking at ``formal systems of fuzzy
logic and their fragments.''}
We state that any MTL formula~$\phi$ is a theorem in MTL iff
 $\phi^\bullet$ is a theorem in our system extended with left weakening.

As an axiomatization of MTL, we take a hypersequent formulation of
\citet{baaz2004analytic}, whose rules we show in Figure~\ref{fig:hlbck}.
 \begin{figure}
  \centering
  \fix{add axiom, looking at LBCK in [19], which is Logics without the
  contraction rule by Komori}

  (Internal and External) Structural rules\\
  \aseq{\mathcal H\hmid \G}{\phi}
  \LL{(w,l)}
  \useq{\mathcal H\hmid \G,\psi}{\phi}
  \DisplayProof
  \hfill
  \aseq{\mathcal H\hmid\G}{\bar{0}}
  \LL{(w,r)}
  \useq{\mathcal H\hmid \G}{\phi}
  \DisplayProof
  \ruleskip
  \AxiomC{$\mathcal H$}
  \LL{(EW)}
  \useq{\mathcal H\hmid G}{\phi}
  \DisplayProof
  \hfill
  \aseq{\mathcal H\hmid\D_0,\G_0}{\phi}
  \aseq{\mathcal H\hmid \D_1,\G_1}{\psi}
  \LL{(com)}
  \bseq{\mathcal H\hmid \D_0,\D_1}{\phi\hmid\G_0,\G_1\tr \psi}
  \DisplayProof \ruleskip
  \aseq{\mathcal H\hmid\G}{\phi}
  \aseq{\mathcal H\hmid \phi,\D}{\psi}
  \LL{(cut)}
  \bseq{\mathcal H\hmid\G,\D}{\psi}
  \DisplayProof
  \ruleskip
  Logical rules (Multiplicative fragment)\ruleskip
  \aseq{\mathcal H\hmid\G,\phi,\psi}{\chi}
  \LL{$\otimes$, l}
  \useq{\mathcal H\hmid \G,\phi\otimes\psi}{\chi}
  \DisplayProof \hfill
  \aseq{\mathcal H\hmid\G}{\phi}
  \aseq{\mathcal H\hmid\D}{\psi}
  \LL{$\otimes$, r}
  \bseq{\mathcal H\hmid \G,\D}{\phi\otimes \psi}
  \DisplayProof \ruleskip
  \aseq{\mathcal H\hmid\G}{\phi}
  \aseq{\mathcal H\hmid\D,\psi}{\chi}
  \LL{$\limp$l}
  \bseq{\mathcal H\hmid \G,\D,\phi\limp\psi}{\chi}
  \DisplayProof \hfill
  \aseq{\mathcal H\hmid\G,\phi}{\psi}
  \useq{\mathcal H\hmid\G}{\phi\limp\psi}
  \DisplayProof \ruleskip
  Logical rules (Additive fragment) \ruleskip
  \aseq{\mathcal H\hmid\G,\phi}{\chi}
  \aseq{\mathcal H\hmid\G,\psi}{\chi}
  \LL{($\vee$, l)}
  \bseq{\mathcal H\hmid\G,\phi\lor\psi}{\chi}
  \DisplayProof
  \hfill
  \aseq{\mathcal H\hmid \G}{\phi_i}
  \LL{($\vee$, r)}
  \useq{\mathcal H\hmid \G}{\phi_0\lor \phi_1}
  \DisplayProof

  \caption[The rules in $\HLBCK$~\citep{baaz2004analytic}, which
  characterizes monoidal t-norm logic.]
  {The rules in $\HLBCK$~\citep{baaz2004analytic}, which
  characterizes monoidal t-norm logic.  Axioms are not shown in
  \citet{baaz2004analytic} so we took them from \fix{cite ono,komori}
  The (cut) rule is eliminatable by
  \citet[Theorem~3.2]{baaz2004analytic}.
  We removed the rules about $\wedge$ because the connective $\wedge$ is
  definable as in Equation~(\ref{eq:abb})}
  \label{fig:hlbck}
 \end{figure}

\subsubsection{Soundness}

\begin{proposition}
 If a hypersequent $\mathcal H$ is
 derivable in $\HLBCK$, then the translation $\sem{\mathcal H}$ is
 derivable in our system extended with left weakening.
\end{proposition}

\subsubsection{Completeness}

\begin{proposition}
 \label{prop:complete-structural}
 All rules except (cut) are \fix{state}
\end{proposition}
\begin{proof}
 We employ the same strategy as \thref{prop:complete-structural}.
 \begin{description}
  \item[(Other non-branching rules)]
       For the other non-branching rules, the outermost structure of all encodings are
       the same.  Moreover, the inner structure is
       straightforward\fix{?}
  \item[Other branching rules]
       For the other branching rules, the outermost structure of all
       encodings are the same.  Again, the inner structure is straightforward.
 \end{description}
\end{proof}


\subsection{Comparison with \FLe}

\section{Discussion}

\subsection{Adding Exponentials}
\fix{add if resources allow}

\subsection{Comparison with the Hypersequent Formulation}
\fix{fill}


\section*{where to put them}

``Undecidability of second order linear logic'' has
\begin{align*}
 \phi\otimes \psi&\equiv \forall X((\phi\limp\psi\limp X)\limp X) \\
 {1}      &\equiv \forall X(X\limp X)\\
 \exists X\phi   &\equiv \forall Y((\forall X(\phi\limp Y))\limp Y)
\end{align*}

Not all disjunctive tautologies are valid in G\"odel--Dummett logic:
$(P\limp Q)\lor(Q\limp R)$.

Non-abortfullness is not a pole.
In order to change this, we have to do something more subtle.
