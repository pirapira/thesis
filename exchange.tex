\chapter{The Logic of Information Exchange}
\label{ch:exchange}

\subsection{Summary}

After studying $(\phi\limp\psi)\oplus (\psi\limp\phi)$,
it is natural to change the additive disjunction $\oplus$ into
multiplicative conjunction $\otimes$ and see what happens%
\footnote{Takeuti Izumi asked what about conjunctions.}.
A natural way to add $(\phi\limp\psi)\otimes(\psi\limp\phi)$ as an axiom
is adding a pair of primitives $\lpair{c,\co c}$ so that
$\cdots ct \cdots \co c u \cdots$ reduces to
$\cdots u  \cdots t \cdots$: in words,
$c$ outputs $\co c$'s input and vice versa.
However, there is one problem: what happens to $\co c(c t)$?
In this case, we do not know the output of $c$ because we only have an
equality between $\co c$'s input and $c$'s output.
Fortunately, we just want to know the output of $\co c$, which is the
input of $c$, that is, $t$.

axiom

usual exchange

nested

nested more complicated

The previous chapters treated the computational interpretations of
disjunctive formulae like $(\phi\imp\psi)\lor(\psi\imp\phi)$ or
$(\phi\limp\psi)\oplus(\psi\limp\phi)$.  In this chapter, we try
replacing these disjunctions with conjunctions.
In the former case, the change renders the logic inconsistent.
If we add the axiom $(\phi\imp\psi)\land(\psi\imp\phi)$ to the
intuitionistic propositional logic,
we can prove any formula.  However in the lattar case, the change does
not make the system meaningless.
In this chapter, we treat
the axioms of the form $(\phi\limp\psi)\otimes(\psi\limp\phi)$
on top of IMLL2, the second order formulation of intuitionistic
multiplicative linear
logic.  In essence, the axiom allows two processes to wait for one
another and then exchange information.

\section{Definitions}

\subsection{Terms and Free Variables}

\fix{channels, involution}

Following Abramsky \fix{cite}, we defne patterns binding sets of
variables:
\begin{itemize}
 \item $\ast$ and $\_$ are patterns binding $\emptyset$,
 \item $\lpair{x,\_}$, $\lpair{\_,x}$ and $!x$ are patterns binding
       $\{x\}$,
 \item $x\otimes y$ and $x@y$ are patterns binding $\{x,y\}$.
\end{itemize}
Using patterns, we define a term $t$ with free variables~$S$ inductively:
\begin{itemize}
 \item a variable $x$ is a term with free variables $\{x\}$,
 \item $\ast$ is a term with free variables $\emptyset$,
 \item if $t$ is a term with free variables~$X$, $u$ is a term with
       free variables~$Y$ and $X$ and $Y$ are disjoint, $t\otimes u$ and
       $tu$ are terms with free variables $X\cup Y$,
 \item if $t$ and $u$ are terms with free variables $X$, then
       $\lpair{t,u}$ is a term with free variables~$X$,
 \item if $t$ is a term with free variables~$X$, then
       $\inl x, \inr t$ and $!t$ are terms with free variables~$X$
 \item if $t$ is a term with free variables $X\cup \{x\}$ and $x$ is not
       in $X$, then $\lambda x.t$ is a term with free variables~$X$,
 \item if $t$ is a term with free variables~$X$, $p$ is a pattern
       binding $Y$, $u$ is a term with free variables $Y\cup Z$ and
       $X\cap Z = Y\cap Z = \emptyset$, then,
       $\letin t p u$ is a term with free variables $X\cup Z$,
 \item if $t$ is a term with free variables $X$,
       $u$ is a term with free variables $Z\cup \{x\}$,
       $v$ is a term with free variables $Z\cup \{y\}$,
       $x,y\notin Z$ and $X\cap Z = \emptyset$,
       $\mat t x u y v$ is a term with free variables $X\cup Z$, and
 \item channels are terms with free variables~$\emptyset$.
\end{itemize}
Note that a term with free variables $X$ is not a term with free
variables $Y$ when $X\neq Y$.  Only the last clause is original,
introducing channels, which are our communication primitives.

\subsection{Typing Derivations}

On top of Abramsky's \fix{} we add a rule to make
$(\phi\limp\psi)\otimes(\psi\limp\phi)$ derivable\fix{really?}.

The typing rules are in Figure~\ref{fig:exchange:rules}.
 \begin{figure}
  \centering
  % axiom
  \AxiomC{}
  \LL{Ax}
  \UnaryInfC{$\tj{x}{\phi}\tr\tj{x}{\phi}$}
  \DisplayProof
  %
  \hfill \fix{add external exchange} \hfill
  % exchange
  \AxiomC{$\hypert\hmid\G,\tj{x}{\phi},\tj{y}{\psi},\D\tr\tj{t}{\theta}$}
  \LL{IE}
  \UnaryInfC{$\hypert\hmid\G,\tj{y}{\psi},\tj{x}{\phi},\D\tr\tj{t}{\theta}$}
  \DisplayProof
  %
  \ruleskip
  \AxiomC{$\hypert$}
  \AxiomC{$\hypert'$}
  \LL{merge}
  \BinaryInfC{$\hypert\hmid\hypert'$}
  \DisplayProof
  % cut XXX is this necessary?; yes
  \hfill
  \AxiomC{$\hypert\hmid\G\tr\tj{t}{\phi}\hmid\tj{x}{\phi},\D\tr\tj{u}{\psi}$}
  \LL{Cut}
  \UnaryInfC{$\hypert\hmid\G,\D\tr\tj{u[t/x]}{\psi}$}
  \DisplayProof
  %
  \ruleskip
  % 1R
  \AxiomC{}
  \LL{$\one$R}
  \UnaryInfC{$\tr\tj{\ast}{\one}$}
  \DisplayProof
  %
  \hfill
  % 1L
  \AxiomC{$\hypert\hmid\G\tr\tj{t}{\phi}$}
  \LL{$\one$L}
  \UnaryInfC{$\hypert\hmid\G,\tj{z}{\one}\tr\tj{\letin z \ast t}{\phi}$}
  \DisplayProof
  %
  \ruleskip
  % otimes R
  \AxiomC{$\hypert\hmid\G\tr\tj{t}{\phi}\hmid\D\tr\tj{u}{\psi}$}
  \LL{$\otimes$R}
  \UnaryInfC{$\hypert\hmid\G,\D\tr\tj{t\otimes u}{\phi\otimes \psi}$}
  \DisplayProof
  %
  \hfill
  % sync
  \AxiomC{$\hypert\hmid\G\tr\tj{t}{\phi}\hmid \D\tr\tj{u}{\psi}$}
  \LL{sync}
  \UnaryInfC{$\hypert\hmid
  \G\tr\tj{ct}{\psi}\hmid \D\tr\tj{\co cu}{\phi}$}
  \DisplayProof
  %
  \ruleskip
  % otimes L
  \AxiomC{$\hypert\hmid\G,\tj{x}{\phi},\tj{y}{\psi}\tr\tj{t}{\theta}$}
  \LL{$\otimes$L}
  \UnaryInfC{$\hypert\hmid\G,\tj{z}{\phi\otimes\psi}\tr\tj{\letin{z}{x\otimes
  y}{t}}{\theta}$}
  \DisplayProof
  %
  \ruleskip
  % limp R
  \AxiomC{$\hypert\hmid\G,\tj{x}{\phi}\tr\tj{t}{\psi}$}
  \LL{$\limp$R}
  \UnaryInfC{$\hypert\hmid\G\tr\tj{\lambda x.t}{\phi\limp \psi}$}
  \DisplayProof
  %
  \hfill
  % limp L
  \AxiomC{$\hypert\hmid\G\tr\tj{t}{\phi}\hmid\tj{x}{\psi},\D\tr\tj{u}{\theta}$}
  \LL{$\limp$L}
  \UnaryInfC{$\hypert\hmid\G,\tj{f}{\phi\limp\psi},\D\tr \tj{u[(ft)/x]}{\theta}$}
  \DisplayProof
  %
  \ruleskip
  % andR
  \AxiomC{$\hypert\hmid\G\tr\tj{t}{\phi}\hmid\G\tr\tj{u}{\psi}$}
  \LL{$\with$R}
  \UnaryInfC{$\hypert\hmid\G\tr\tj{\lpair{t,u}}{\phi\with\psi}$}
  \DisplayProof
  %
  \ruleskip
  % andL0
  \AxiomC{$\hypert\hmid\G,\tj{x}{\phi}\tr\tj{t}{\theta}$}
  \LL{$\with$L$_0$}
  \UnaryInfC{$\hypert\hmid\G,\tj{z}{\phi\with\psi}\tr\tj{\letin{z}{\lpair{x,\_}}{t}}{\theta}$}
  \DisplayProof
  %
  \ruleskip
  % andL1
  \AxiomC{$\hypert\hmid\G,\tj{y}{\psi}\tr\tj{t}{\theta}$}
  \LL{$\with$L$_1$}
  \UnaryInfC{$\hypert\hmid\G,\tj{z}{\phi\with\psi}\tr\tj{\letin{z}{\lpair{\_,y}}{t}}{\theta}$}
  \DisplayProof
  %
  \ruleskip
  % oplus R0
  \AxiomC{$\hypert\hmid\G\tr\tj{t}{\phi}$}
  \LL{$\oplus$R$_0$}
  \UnaryInfC{$\hypert\hmid\G\tr\tj{\inl{t}}{\phi\oplus\psi}$}
  \DisplayProof
  %
  \hfill
  % oplus R1
  \AxiomC{$\hypert\hmid\G\tr\tj{u}{\psi}$}
  \LL{$\oplus$R$_1$}
  \UnaryInfC{$\hypert\hmid\G\tr\tj{\inr{u}}{\phi\oplus\psi}$}
  \DisplayProof
  %
  \ruleskip
  % oplus L
  \AxiomC{$\hypert \hmid \G,\tj{x}{\phi}\tr\tj{u}{\theta}\hmid
  \G,\tj{y}{\psi}\tr\tj{v}{\theta}$}
  \LL{$\oplus$L}
  \UnaryInfC{$\hypert\hmid\G,\tj{z}{\phi\oplus\psi}\tr\tj{\mat{z}{x}{u}{y}{v}}{\theta}$}
  \DisplayProof
  %
  \ruleskip
  % !R
  \AxiomC{$\hypert\hmid!\G\tr\tj{t}{\phi}$}
  \LL{$!$R}
  \UnaryInfC{$\hypert\hmid!\G\tr\tj{!t}{!\phi}$}
  \DisplayProof
  %
  \ruleskip
  % dereliction
  \AxiomC{$\hypert\hmid\G,\tj{x}{\phi}\tr\tj{t}{\psi}$}
  \LL{Dereliction}
  \UnaryInfC{$\hypert\hmid\G,\tj{z}{!\phi}\tr\tj{\letin{z}{!x}{t}}{\psi}$}
  \DisplayProof
  %
  \ruleskip
  % contraction
  \AxiomC{$\hypert\hmid\G,\tj{x}{!\phi},\tj{y}{!\phi}\tr\tj{t}{\psi}$}
  \LL{Contraction}
  \UnaryInfC{$\hypert\hmid\G,\tj{z}{!\phi}\tr\tj{\letin{z}{x@y}{t}}{\psi}$}
  \DisplayProof
  %
  \ruleskip
  % weakening
  \AxiomC{$\hypert\hmid\G\tr\tj{t}{\psi}$}
  \LL{Weakening}
  \UnaryInfC{$\hypert\hmid\G,\tj{z}{!\phi}\tr\tj{\letin{z}{\_}{t}}{\psi}$}
  \DisplayProof
  %
  \ruleskip
  % forall R
  \AxiomC{$\hypert\hmid\G\tr\tj{t}{\phi}$}
  \LL{$\forall$R}
  \UnaryInfC{$\hypert\hmid\G\tr\tj{t}{\forall X.\phi}$}
  \DisplayProof (No $X$ appears in $\G$)
  %
  \ruleskip
  % forall L
  \AxiomC{$\hypert\hmid\G,\tj{x}{\phi[\psi/X]}\tr\tj{t}{\phi}$}
  \LL{$\forall$L}
  \UnaryInfC{$\hypert\hmid\G,\tj{x}{\forall X.\phi}\tr\tj{t}{\phi}$}
  \DisplayProof
  %
  \ruleskip
  %
  \caption{Most rules are taken from Abramsky\fix{}.
  The sync rule is original.}
  \label{fig:exchange:rules}
 \end{figure}

\subsection{Evaluation relation}

The set of canonical forms remains the same as Abramsky's
system~\fix{cite}:
\[
 \lpair{t,u}\qquad !t\qquad \ast\qquad c\otimes d\qquad \lambda
 x.t\qquad \inl{v}\qquad\inr{w}
\]
where $v$ and $w$ are canonical forms.

$\mathcal E$ stands for a sequence of evaluation relations.
Most rules are the same as Abramsky's \fix{cite}.
We add the semantics for channels.
The definition is inductive in Figure~\ref{fig:eval}.

\newcommand{\hypere}{\mathcal{E}}

 \begin{figure}
  \centering
  \AxiomC{}
  \UnaryInfC{$\ast\eval\ast$}
  \DisplayProof
  \hfill
  \AxiomC{$\hypere\hmid t\eval \ast \hmid u\eval v$}
  \UnaryInfC{$\hypere\hmid \letin t \ast u\eval v$}
  \DisplayProof
  \hfill
  \AxiomC{$\hypere\hmid t\eval v\hmid u\eval w$}
  \UnaryInfC{$\hypere\hmid t\otimes u\eval v\otimes w$}
  \DisplayProof
  \ruleskip
  \AxiomC{$\hypere\hmid t\eval v\otimes d\hmid u[v/x,w/y]\eval v'$}
  \UnaryInfC{$\hypere\hmid \letin t {x\otimes y} u \eval v'$}
  \DisplayProof
  \hfill
  \AxiomC{}
  \UnaryInfC{$\lambda x.t\eval \lambda x.t$}
  \DisplayProof
  \ruleskip
  \AxiomC{$\hypere\hmid t\eval \lambda x.t'\hmid u\eval v\hmid
  t'[v/x]\eval w$}
  \UnaryInfC{$\hypere\hmid tu\eval w$}
  \DisplayProof
  \hfill
  \AxiomC{$\hypere\hmid t\eval v\hmid u\eval w$}
  \UnaryInfC{$\hypere\hmid ct\eval w\hmid \co cu\eval v$}
  \DisplayProof
  \ruleskip
  \AxiomC{}
  \UnaryInfC{$\lpair{t,u}\eval\lpair{t,u}$}
  \DisplayProof
  \hfill
  \AxiomC{$\hypere\hmid t\eval \lpair{t_0,t_1}\hmid t_0\eval v\hmid
  u[v/x]\eval w$}
  \UnaryInfC{$\letin t {\lpair{x,\_}}{u}\eval w$}
  \DisplayProof
  \ruleskip
  \AxiomC{$\hypere\hmid t\eval\lpair{t_0,t_1}\eval t_1\eval v\hmid
  u[v/y]\eval w$}
  \UnaryInfC{$\hypere\hmid\letin t{\lpair{\_,y}}u\eval w$}
  \DisplayProof
  \ruleskip
  \AxiomC{$\hypere\hmid t\eval v$}
  \UnaryInfC{$\hypere\hmid \inl{t}\eval \inl{v}$}
  \DisplayProof
  \hfill
  \AxiomC{$\hypere\hmid u\eval w$}
  \UnaryInfC{$\hypere \hmid \inr{u}\eval \inr{w}$}
  \DisplayProof
  \ruleskip
  \AxiomC{$\hypere\hmid t\eval \inl{v}\hmid u[v/x]\eval w$}
  \UnaryInfC{$\hypere\hmid \mat t x u y {u'}\eval w$}
  \DisplayProof
  \ruleskip
  \AxiomC{$\hypere\hmid t\eval \inr{v}\hmid u'[v/y]\eval w$}
  \UnaryInfC{$\hypere\hmid \mat t x u y {u'}\eval w$}
  \DisplayProof
  \ruleskip
  \AxiomC{}
  \UnaryInfC{$\hypere\hmid !t\eval !t$}
  \DisplayProof
  \hfill
  \AxiomC{$\hypere\hmid t\eval !s\hmid s\eval v\hmid u[v/x]\eval w$}
  \UnaryInfC{$\hypere \hmid \letin t {!x} u\eval w$}
  \DisplayProof
  \ruleskip
  \AxiomC{$\hypere\hmid t\eval !s\hmid u\eval v$}
  \UnaryInfC{$\hypere \hmid \letin t {\_} u\eval v$}
  \DisplayProof
  \hfill
  \AxiomC{$\hypere\hmid t\eval !s\hmid u[!s/x,!s/y]\eval v$}
  \UnaryInfC{$\letin t {x@y} u\eval v$}
  \DisplayProof
  \caption{The definition of evaluation relation.}
  \label{fig:eval}
 \end{figure}

\section{Determinacy and Confluence}


\section{Conclusion}


\section{Discussion}

It is tempting to add modalities to types so that the
modalities show agents and then study the relationship with the
multiparty session types \fix{cite}.